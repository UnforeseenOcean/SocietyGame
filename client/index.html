<!DOCTYPE html>
<head>
	<link rel="icon" href="data:;base64,iVBORw0KGgo=">
    <link href="grid.css" rel="stylesheet" type="text/css" />
	<link href="client/grid.css" rel="stylesheet" type="text/css" />
	<link href="main_mobile.css" rel="stylesheet" type="text/css" />
	<link href="client/main_mobile.css" rel="stylesheet" type="text/css" />

    <title>Society</title>
</head>

<!--socket-->
<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>

<!--<script src="node_modules/jquery/dist/jquery.min.js"></script>-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>

<div class = "container">
	<div class = "row" id = "info">
		<div class = "col-md-50" id="info1">
			<h1 id="worldscore">worldscore</h1>
			<h2 id="nationscore">insert number here</h2>
			<h3 id="individualscore">insert number here</h3>
		</div>
		<div class = "col-md-50" id = "info2">
			<h4 id="timer"></h4>
			<h4 id="playerNumber">insert number here</h4>
			<footer id="roundnumber">Round Number: 1</footer>
		</div>
	</div>
	<div class = "row">
		<div class="col-md-45">
			<button class="decision" id="decision1" onclick="decision1()"></button>
			<h3></h3>
			<button class="decision" id="decision2" onclick="decision2()"></button>
			<h3></h3>
		</div>
		<div class = "col-md-45 col-md-offset-10">
			<button class="decision" id="decision3" onclick="decision3()"></button>
			<h3></h3>
			<button class="decision" id="decision4" onclick="decision4()"></button>
		</div>
	</div>
</div>


<!-- INITIALIZATION -->

<script>

	var socket = io();
	var playerScore = 20;
	
	var playerNumberInput = prompt("What player number are you?");
	var teamNameInput = prompt("What nation are you on?\n" +
							   "1: Japan, 2: Canada, 3: UK, 4: Turkey\n" +
							   "5: Russia, 6: China, 7: Mexico");
	var groupNumberInput = prompt("What group are you in?\n" +
								  "1: Education, 2: Military, 3: Workforce, 4: Policy Makers");

	var NATIONS = {1: "Japan",
				   2: "Canada",
				   3: "UK",
				   4: "Turkey",
				   5: "Russia",
				   6: "China",
				   7: "Mexico"};

	var DECISIONS = [{1: "Pocket money from school fundraiser",
					  2: "Buy school supplies for students out of pocket",
					  3: "Inflate students' test scores",
					  4: "Go teach for a year to impoverished students"},
					 {1: "Extort local families in the war zone",
					  2: "Fight on the front lines",
					  3: "Use biochemical warfare",
					  4: "Give rations to starving children in war zone"},
					 {1: "Buy a boat with company money",
					  2: "Come in on Saturdays",
					  3: "Switch production to fossil fuels for a month to lower production costs",
					  4: "Donate to charity"},
					 {1: "Take a bribe to lower emissions requirements",
					  2: "Attend every voting session",
					  3: "Impose tariffs on international trade",
					  4: "Give time to international disaster relief organization"}];

	createDecisions(groupNumberInput);
	
	var playerNumber = playerNumberInput;
	var teamName = NATIONS[teamNameInput];
	var teamNumber = 0;
	var groupNumber = [];
	
	socket.emit('playerConnect', {playerNumber: playerNumber, teamName: teamName, groupNumberInput: groupNumberInput});

	socket.on('getTeamNumber', function(data) {
		teamNumber = data.teamNameNumbers[teamName];
		groupNumber = data.groupNumber;
	});


	
	
/*LISTENERS*/
	
	socket.on('player', function(data) {
		document.getElementById('playerNumber').innerHTML = "Player Number: " + playerNumber;
		document.getElementById('individualscore').innerHTML = "Individual Score: " + playerScore;
	});

	socket.on('timer', function(data) {
		document.getElementById('timer').innerHTML = "Time Left: " + data.timer;
	});

	socket.on('world', function(data) {
		document.getElementById('worldscore').innerHTML = "World Score: " + data.world;
	});

	socket.on('team', function(data) {
		document.getElementById('nationscore').innerHTML = teamName + "'s Score: " + data.team;
	});
	
	socket.on('decisionUpdate', function(data) {
		playerScore = data.playerScore;
		document.getElementById('individualscore').innerHTML = "Individual Score: " + playerScore;
		document.getElementById('nationscore').innerHTML = teamName + "'s Score: " + data.teamScore;
		document.getElementById('worldscore').innerHTML = "World Score: " + data.world;
	});

	socket.on('enable', function(data) {
		enableButtons();
	});

	socket.on('nextRound', function(data) {
		document.getElementById('roundnumber').innerHTML = "Round Number: " + data.roundNumber;
	});
	
	socket.on('newQuarter', function() {
		swapToInvestigation();
	});

	socket.on('worldEnd', function() {
		window.location = "http://corgiorgy.com";
	});
	
	
	
/*FUNCTIONS*/

	function createDecisions(group) {
		console.log(DECISIONS[group - 1]);
		document.getElementById('decision1').innerHTML = DECISIONS[group - 1][1];
		document.getElementById('decision2').innerHTML = DECISIONS[group - 1][2];
		document.getElementById('decision3').innerHTML = DECISIONS[group - 1][3];
		document.getElementById('decision4').innerHTML = DECISIONS[group - 1][4];
	};
	
	var disableButtons = function() {
		document.getElementById('decision1').disabled = true;
		document.getElementById('decision2').disabled = true;
		document.getElementById('decision3').disabled = true;
		document.getElementById('decision4').disabled = true;
	};
	
	var enableButtons = function() {
		document.getElementById('decision1').disabled = false;
		document.getElementById('decision2').disabled = false;
		document.getElementById('decision3').disabled = false;
		document.getElementById('decision4').disabled = false;
	};

	var decision1 = function() {
		socket.emit('decision1', {playerNumber: playerNumber, groupNumber: groupNumber, teamNumber: teamNumber});
		disableButtons();
	};
	
	var decision2 = function() {
		socket.emit('decision2', {playerNumber: playerNumber, groupNumber: groupNumber, teamNumber: teamNumber});
		disableButtons();
	};
	
	var decision3 = function() {
		socket.emit('decision3', {playerNumber: playerNumber, groupNumber: groupNumber, teamNumber: teamNumber});
		disableButtons();
	};
	
	var decision4 = function() {
		socket.emit('decision4', {playerNumber: playerNumber, groupNumber: groupNumber, teamNumber: teamNumber});
		disableButtons();
	};
	
	var swapToInvestigation = function() {
		$("#decisionScreen").replaceWith(
			'<div id="investigationScreen" style=" width: 100%; text-align: center"> \
			<h1 id="worldscore">worldscore</h1> \
			<h2 id="nationscore">insert number here</h2> \
			<h3 id="individualscore">insert number here</h3> \
			<h4 id="timer">insert number here</h4> \
			<h4 id="playerNumber">insert number here</h4> \
			<h2>Investigations!</h2> \
			<footer id="roundnumber">roundnumber</footer> \
			<button class="decision" id="investigate1" onclick="">Investigate Player 1</button> \
			<h3></h3> \
			<button class="decision" id="investigate2" onclick="">Investigate Player 2</button> \
			<h3></h3> \
			<button class="decision" id="investigate3" onclick="">Investigate Player 3</button> \
			<h3></h3> \
			<button class="decision" id="investigate4" onclick="">Investigate Player 4</button> \
			</div>'
		);
		socket.emit('infoRequest', {});
	};
	
	var swapToDecision = function() {
		$("#investigationScreen").replaceWith(
			'<div id="decisionScreen" style=" width: 100%; text-align: center"> \
			<h1 id="worldscore">worldscore</h1> \
			<h2 id="nationscore">insert number here</h2> \
			<h3 id="individualscore">insert number here</h3> \
			<h4 id="timer">insert number here</h4> \
			<h4 id="playerNumber">insert number here</h4> \
			<footer id="roundnumber">roundnumber</footer> \
			<button class="decision" id="decision1" onclick="decision1()">Be a shithead</button> \
			<h3></h3> \
			<button class="decision" id="decision2" onclick="decision2()">Team Player</button> \
			<h3></h3> \
			<button class="decision" id="decision3" onclick="decision3()">Mi casa, tu casa</button> \
			<h3></h3> \
			<button class="decision" id="decision4" onclick="decision4()">I drive a hybrid, bitch</button> \
			</div>'		
		);
		socket.emit('infoRequest', {});
	};
	
</script>