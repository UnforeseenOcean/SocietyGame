<!doctype html>

<!-- HTML -->

<html>
	<head>
		<meta charset="utf-8">
		<title>Society Game Host</title>
		<link href="main_host.css" rel="stylesheet" type="text/css" />
		<link href="client/main_host.css" rel="stylesheet" type="text/css" />
	</head>

	<body>
		
		<div class="container">
		<h2 id="roundnumber">Round Number: 1</h2>
		<div id="starttimer"></div>
		<table id="nations" align="center" border="0" cellpadding="20">
			<tbody>
				<tr></tr>
			</tbody>
		</table>
			<div class ="centeredInline">
				<h2 id="timer"></h2>
				<h2 id="worldscore"></h2>
			</div>
			
			<table class ="cellTable" id="nations">
				<tbody>
					<tr></tr>
				</tbody>
			</table>
		</div>

	<!--socket-->
	<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>

	
<!-- INITIALIZATION -->
	
	<script type="text/javascript">
	
			var socket = io();

			var mode = prompt("How would you like rounds to end? \n" +
							  "1: Timer, 2: Wait for everyone to make a decision");
			var numberOfTeams = prompt("How many teams will there be?");
			var numberOfGroups = prompt("How many groups will be in each team?");
			var numberOfPlayersInGroups = prompt("How many players are in each group?");
			var numberOfPlayers = numberOfTeams * numberOfGroups * numberOfPlayersInGroups;
			var numberOfPlayersInTeams = numberOfGroups * numberOfPlayersInGroups;
			

			var nationscore = 20 * numberOfGroups;
			var individualscore = 20;
			var roundnumber = 1;
			var teamNumberNames = {};
			var GROUP_NAMES = {1: "Education",
							  2: "Military",
							  3: "Workforce",
							  4: "Policy Makers"};

			socket.emit('start', {
				numberOfTeams: numberOfTeams,
				numberOfGroups: numberOfGroups,
				numberOfPlayers: numberOfPlayers,
				numberOfPlayersInGroups: numberOfPlayersInGroups,
				numberOfPlayersInTeams: numberOfPlayersInTeams,
				mode: mode
			});

			document.getElementById('worldscore').innerHTML = "World Score: " + 10 * numberOfTeams;

			var nations = document.getElementById('nations');
			nations.cellSpacing = 200 / numberOfGroups;
			createCell(nations.rows[0].insertCell(0), "Q1", 'col scoreCell', "quarterlyreports");
			for (var i = 1; i <= numberOfTeams; i++) {
				addNation(i);
			};
			for (var i = 1; i <= numberOfGroups; i++) {
				addGroup(i);
			};
			
			
/*LISTENERS*/
			
			socket.on('newTeam', function(data) {
				teamNumberNames[data.currentTeamNumber] = data.teamName;
				document.getElementById(data.currentTeamNumber).innerHTML = data.teamName + "'s Score: " + nationscore;
			});
			
			socket.on('nextRound', function(data) {
				document.getElementById("roundnumber").innerHTML = "Round Number: " + data.roundNumber;
			});

			socket.on('quarter', function(data) {
				for (var i = 1; i <= numberOfTeams; i++) {
					document.getElementById(i).innerHTML = teamNumberNames[i] + "'s Score: " + data.teamScores[i];
					for (var j = 1; j <= numberOfGroups; j++) {
						document.getElementById([i, j]).innerHTML = "Group Score: " + data.groupScores[[i, j]];
					};
				};
			});

			socket.on('newQuarter', function(data) {
				document.getElementById('quarterlyreports').innerHTML = "Q" + data.quarter;
			});

			socket.on('worldEnd', function() {
				window.location = "http://corgiorgy.com";
			});

			socket.on('decisionUpdate', function(data) {
				document.getElementById('worldscore').innerHTML = "World Score: " + data.world;
			});

			socket.on('startTimer', function(data) {
				document.getElementById('timer').innerHTML = "Time Left: " + data.timer;
				$("#starttimer").replaceWith('<button id="starttimer" onclick="beginGame()">Start Timer</button>')
			});

			socket.on('timer', function(data) {
				document.getElementById('timer').innerHTML = "Time Left: " + data.timer;
			});
			
			
/*FUNCTIONS*/
			
			function createCell(cell, text, style, id=null) {
				var div = document.createElement('div');
				var txt = document.createTextNode(text);
				div.appendChild(txt);
				div.setAttribute('class', style);
				div.setAttribute('className', style);
				div.setAttribute('id', id);
				cell.appendChild(div);
			};

			function addNation(nation) {
				createCell(nations.rows[0].insertCell(nations.rows[0].cells.length), "Nation Score: " + nationscore, 'col scoreCell', nation);
			};

			function addGroup(group) {
				var row = nations.insertRow(nations.rows.length);
				createCell(row.insertCell(0), GROUP_NAMES[group], 'row scoreCell');
				for (var i = 1; i < nations.rows[0].cells.length; i++) {
					createCell(row.insertCell(i), 20, 'row scoreCell', [i + 1, group]);
				};
			};

			function beginGame() {
				socket.emit('beginGame', {});
				$("#starttimer").remove();
			};

	</script>	
	</body>
</html>
