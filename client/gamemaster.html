<!doctype html>

<!-- HTML -->

<html>
	<head>
		<meta charset="utf-8">
		<title>GameMaster</title>
	</head>

	<body>
	
		
		<button onclick="advanceRound()">Advance Round</button>
		<br>
		<br>
		<br>
		<br>
		
			Username:<br>
			<input type="username" id="username"><br>
			New Score:<br>
			<input type="text" id="newIndividualScore">
			<br>
			<br>
			<br>
			Team number:----------------Group Number:<br>
			<input type="team" id="teamNumber"><input type="group" id="groupNumber">
			<br>
			New Scores:<br>
			<input type="text" id="newTeamScore"><input type="text" id="newGroupScore">
			<br>
			<br>
			<br>
			New World Score:<br>
			<input type="world" id="newWorldScore">
			<br>
			<br>
			<br>
			<input type="button" value="Change" id="submitButton">
		

		<button onclick="removePlayer()">Remove Player</button>


		<table id="playerTable">
			<tbody>
				<tr></tr>
			</tbody>
		</table>




		<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
		<script type="text/javascript">
			var socket = io();

			var NATIONS;
			var GROUP_NAMES;
			var numberOfTeams;
			var numberOfGroups;

			socket.emit("gameMasterConnect", {});

			socket.on("giveGameMasterData", function(data) {
				NATIONS = data.NATIONS;
				GROUP_NAMES = data.GROUP_NAMES;
				numberOfTeams = data.numberOfTeams;
				numberOfGroups = data.numberOfGroups;
				var playerTable = document.getElementById("playerTable");
				playerTable.cellSpacing = 200 / numberOfGroups;
				createCell(playerTable.rows[0].insertCell(0), "Player Table", 'col scoreCell');
				for (var i = 1; i <= numberOfTeams; i++) {
					addNation(i);
				};
				for (var i = 1; i <= numberOfGroups; i++) {
					addGroup(i);
				};
			});

			socket.on("putPlayerInGameMasterTable", function(data) {
				document.getElementById(data.groupNumber).innerHTML += data.username + "<br>";
			});

			socket.on("removePlayerFromTable", function(data) {
				var element = "[id='" + data.groupNumber + "']";
				$(element).html($(element).html().split(data.username + "<br>").join(""));
			});

			function createCell(cell, text, style, id=null) {
				var div = document.createElement('div');
				var txt = document.createTextNode(text);
				div.appendChild(txt);
				div.setAttribute('class', style);
				div.setAttribute('className', style);
				div.setAttribute('id', id);
				cell.appendChild(div);
			};

			function addNation(nation) {
				createCell(playerTable.rows[0].insertCell(playerTable.rows[0].cells.length), NATIONS[nation], 'col scoreCell', nation);
			};

			function addGroup(group) {
				var row = playerTable.insertRow(playerTable.rows.length);
				createCell(row.insertCell(0), GROUP_NAMES[group], 'row scoreCell');
				for (var i = 1; i < playerTable.rows[0].cells.length; i++) {
					createCell(row.insertCell(i), "", 'row scoreCell', [i, group]);
				};
			};

			function advanceRound(){
				socket.emit('advanceRoundGM', {});
			};

			function removePlayer() {
				var username = prompt("What is the username of the player you would like to remove?");
				socket.emit("removePlayer", {
					username: username
				});
			};
			var button = document.getElementById("submitButton");
			button.onclick = function() {
				var newIndividualScore =  document.getElementById("newIndividualScore").value;
				var newWorldScore =  document.getElementById("newWorldScore").value;
				var newTeamScore = document.getElementById("newTeamScore").value;
				var newGroupScore = document.getElementById("newGroupScore").value;
				var usernameToChange = document.getElementById("username").value;
				var groupToChange = document.getElementById("groupNumber").value;
				var teamToChange = document.getElementById("teamNumber").value;
				console.log("clicked button");
				console.log(usernameToChange);
				console.log(newIndividualScore);
				console.log(newGroupScore);
				console.log("teamscore " +newTeamScore);
				console.log("worldscore "+newWorldScore);
				console.log("groupscore"+groupToChange);
				console.log(teamToChange);
    			socket.emit('scoreChangeGM', {
    				newGroupScore: newGroupScore,
    				newTeamScore: newTeamScore,
    				newWorldScore: newWorldScore,
    				newIndividualScore: newIndividualScore,
    				usernameToChange: usernameToChange,
    				groupToChange: groupToChange,
    				teamToChange: teamToChange
    			});
    			clearInputs();
			};

			function clearInputs(){
				var inputs = document.getElementsByTagName("INPUT");
				var i;
				for(i in inputs){
					console.log(inputs[i].value);
					inputs[i].value ="";
				}
				
			}

		</script>
	</body>
</html>
